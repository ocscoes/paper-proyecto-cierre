# Resultados

```{r}
#| echo: false

## cargar base

load("input/proc/datos-completos.rdata")


```

# Descriptivos

```{r}
#| label: fig-ch
#| fig-cap: Evolución dimensiones Cohesión Horizontal (2004-2022)


olas <- datos_wide |>
  group_by(ola) |>
  summarise(seguridad_prom = mean(`Seguridad Pública`, na.rm=T),
            confianza_prom = mean(`Confianza Interpersonal`, na.rm=T)) |>
  pivot_longer(
    cols = c(confianza_prom, seguridad_prom),
    names_to = "indicador",
    values_to = "promedio"
  ) |>
  mutate(indicador = recode(indicador,
                            "confianza_prom" = "Confianza Interpersonal",
                            "seguridad_prom" = "Seguridad Pública"))
olas |>
  ggplot(aes(x = ola, y = promedio, color=indicador)) +
  geom_line(linewidth = 1) +
  geom_point() +
  labs(x = "Ola", y = "Promedio", color=NULL) +
  theme_minimal() + 
  theme(legend.position = "bottom")

```


```{r}
#| label: fig-cv
#| fig-cap: Evolución dimensiones Cohesión Vertical (2004-2022)

olas <- datos_wide |>
  group_by(ola) |>
  summarise(confianza_prom = mean(`Confianza en las Instituciones`, na.rm=T),
            democracia_prom = mean(`Actitudes a la Democracia`, na.rm=T),
            justicia_prom = mean(`Justicia Redistributiva`, na.rm=T)) |>
  pivot_longer(
    cols = c(confianza_prom, democracia_prom, justicia_prom),
    names_to = "indicador",
    values_to = "promedio"
  ) |>
  mutate(indicador = recode(indicador,
                            "confianza_prom" = "Confianza en las Instituciones",
                            "democracia_prom" = "Actitudes hacia la democracia",
                            "justicia_prom" = "Justicia Redistributiva"))
olas |>
  ggplot(aes(x = ola, y = promedio, color=indicador)) +
  geom_line(linewidth = 1) +
  geom_point() +
  labs(x = "Ola", y = "Promedio", color=NULL) +
  theme_minimal() + 
  theme(legend.position = "bottom")

```

```{r}
#| label: fig-cs
#| tab-cap: Evolución dimensiones Cohesión Social (2004-2022)

olas <- datos_wide |>
  group_by(ola) |>
  summarise(horizontal_prom = mean(`Cohesión horizontal`, na.rm=T),
            vertical_prom = mean(`Cohesión vertical`, na.rm=T),
            cohesion_prom = mean(`Cohesión general`, na.rm=T)) |>
  pivot_longer(
    cols = c(horizontal_prom, vertical_prom, cohesion_prom),
    names_to = "indicador",
    values_to = "promedio"
  ) |>
  mutate(indicador = recode(indicador,
                            horizontal_prom = "Cohesión Horizontal",
                            vertical_prom = "Cohesión Vertical",
                            cohesion_prom = "Cohesión Social"))
olas |>
  ggplot(aes(x = ola, y = promedio, color=indicador)) +
  geom_line(linewidth = 1) +
  geom_point() +
  labs(x = "Ola", y = "Promedio", color=NULL) +
  theme_minimal() + 
  theme(legend.position = "bottom")

```

# Modelos Multinivel


```{r}
#| label: centrado

datos_wide <- clean_names(datos_wide)

datos_wide <- datos_wide |>
  dplyr::mutate(
    pib_c   = scale(log_pib_per_capita_ppa, scale = FALSE, center = T),
    gini_c  = scale(gini_index, scale = FALSE, center= T),
    vdem_c  = scale(indice_v_dem, scale = FALSE, center=T),
    wgi_c   = scale(wgi, scale = FALSE, center=T),
    mig_c   = scale(percent_pob_migrante, scale = FALSE, center=T)
  )
```


```{r}
#| label: tbl-modelos-horizontal
#| tbl-cap: Modelos para cohesión horizontal 
#| results: asis



# Modelo nulo general
m0 <- lmer(cohesion_horizontal ~ 1 + (1 | pais), data = datos_wide)

m1 <- lmer(cohesion_horizontal ~ factor(ola)  + (1 | pais),
           data = datos_wide)

m2 <- lmer(cohesion_horizontal ~ factor(ola) + pib_c + gini_c + vdem_c + wgi_c + mig_c + (1 | pais),
           data = datos_wide)

m3 <- lmer(cohesion_horizontal ~ factor(ola) + pib_c + gini_c + vdem_c + wgi_c + mig_c + region + (1 | pais),
           data = datos_wide)

# tab_model(m1, m2,m3,
#           show.ci = FALSE, 
#           show.se = TRUE,
#           show.re.var = TRUE,
#           dv.labels = c("Modelo 1", "Modelo 2", "Modelo 3"))

htmlreg(list(m1, m2, m3),
        doctype = FALSE)
```

```{r}
#| label: tbl-modelos-vertical
#| tbl-cap: Modelos para cohesión vertical
#| results: asis

datos_wide <- clean_names(datos_wide)

# Modelo nulo general
m0 <- lmer(cohesion_vertical ~ 1 + (1 | pais), data = datos_wide)

m1 <- lmer(cohesion_vertical ~ factor(ola) + (1 | pais),
           data = datos_wide)

m2 <- lmer(cohesion_vertical ~ factor(ola) + pib_c + gini_c + vdem_c + wgi_c + mig_c + (1 | pais),
           data = datos_wide)

m3 <- lmer(cohesion_vertical ~ factor(ola) + pib_c + gini_c + vdem_c + wgi_c + mig_c + region + (1 | pais),
           data = datos_wide)



# tab_model(m1, m2,m3,
#           show.ci = FALSE, 
#           show.se = TRUE,
#           show.re.var = TRUE,
#           dv.labels = c("Modelo 1", "Modelo 2", "Modelo 3"))

htmlreg(list(m1, m2, m3),
        doctype = FALSE)

```

```{r}
#| label: tbl-modelos-general
#| tbl-cap: Modelos para cohesión social
#| results: asis

datos_wide <- clean_names(datos_wide)

# Modelo nulo general
m0 <- lmer(cohesion_general ~ 1 + (1 | pais), data = datos_wide)

m1 <- lmer(cohesion_general ~ factor(ola) + (1 | pais),
           data = datos_wide)

m2 <- lmer(cohesion_general ~ factor(ola) + pib_c + gini_c + vdem_c + wgi_c + mig_c + (1 | pais),
           data = datos_wide)

m3 <- lmer(cohesion_general ~ factor(ola) + pib_c + gini_c + vdem_c + wgi_c + mig_c +  region + (1 | pais),
           data = datos_wide)

# tab_model(m1, m2,m3,
#           show.ci = FALSE, 
#           show.se = TRUE,
#           show.re.var = TRUE,
#           dv.labels = c("Modelo 1", "Modelo 2", "Modelo 3"))

htmlreg(list(m1, m2, m3),
        doctype = FALSE)

```
